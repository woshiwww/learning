## 学习总结



**快照：**快照就是将照下来的那一刻保留起来作为文件的访问通道，将没修改之前的文件保存在快照存储空间中一份，访问的是外面的数据，如果数据修改出现错误时，可以通过快照的访问路径把存储在快照存储空间中的数据放到被修改的数据中，快照存储空间中只存储没修改前的数据，占据空间比较小。快照的主要作用是保留数据在你做快照那一刻的状态，创建的快照文件本身和你装的操作系统所对应的那块虚拟磁盘本身的大小不一样，快照比原数据小很多，跟文件软链接一样，自己本身不大，但自己所指的文件是很大的。

**物理卷（Physical Volume,PV）：**就是指硬盘分区，也可以是整个硬盘或已创建的软RAID，是LVM（ Logical Volume Manager，逻辑卷管理）的基本存储设备。

**卷组（Volume Group,VG）：**是由一个或多个物理卷所组成的存储池，在卷组上能创建一个或多个逻辑卷。

**逻辑卷（Logical Volume,LV）：**类似于非LVM系统中的硬盘分区，它建立在卷组之上，是一个标准的块设备，在逻辑卷之上可以建立文件系统。

1. 逻辑卷可以做[快照](https://so.csdn.net/so/search?q=快照&spm=1001.2101.3001.7020)

2. 逻辑卷可以突破物理硬盘的大小，动态调整卷大小

3. 性能差一点，比物理卷

4. 建议只能扩 不能缩（否则缩小的话可能会丢失数据）

**例子：**如果把PV比作地球的一个板块，VG则是一个地球，因为地球是由多个板块组成的，那么在地球上划分一个区域并命名这个区域为亚洲，则亚洲就相当于一个LV。逻辑卷就相当于是一个巨大的物理卷组成的存储区域中的一个区域。

### 2022-7-11()

在对象存储中，只有两种资源，分别是桶(Bucket)和对象(Object)

**Bucket：**可以把桶看为一个抽象的容器，没有实体，所有 Object 都必须属于某个 Bucket，无一例外。

**Object：**是用户实实在在上传的数据。

![image-20220711173842455](https://tbwan.oss-cn-chengdu.aliyuncs.com/imgs/%E5%85%83%E6%95%B0%E6%8D%AEimage-20220711173842455.png)

**快照源：**作为产生快照基础的文件或者目录，是可读写的文件或者目录。

**快照：**记录文件或目录某一瞬间的状态。

**快照子集：**创建快照后，对快照子树非根节点的快照入口创建子项，该子项与快照字数根节点入口快照子项之间彼此隔离，所有的这些快照子项构成了快照子集。

**源dentry/inode：**常规文件或者目录的dentry/inode，每个文件或者目录有且仅有一个源inode。

**快照inode：**为保存快照状态而创建的inode，每个文件或目录可以对应多个快照inode，快照版本号与快照inode是一对多的关系。

**快照遗留dentry：**为快照保留的dentry项，通常是已经删除的文件或者目录。

**快照入口dentry：**位于快照专用目录中，是访问快照的唯一入口路径。

**源对象/段：**普通文件的对象/段。

**快照对象/段：**为快照保存文件数据状态而创建的对象/段。

**Filesys_crtver：** 文件系统当前的创建快照版本号，初始值为1。

**Filesys_delver：** 文件系统当前的删除快照版本号，初始值为1。

**snap_ver：**快照版本号，也是这个快照ID的组成部分。

**iver(inode version)：**Inode快照版本号，创建、修改时设置filesys_crtver 。

**iver_max：**入口Inode上创建的最大快照版本号。

**dver_create：**dentry项的创建版本号，取值为创建dentry时的Filesys_crtver。

**dver_delete：**dentry项的删除版本号，取值为删除dentry时的Filesys_crtver。

**dver_pathmax：**从当前目录到根的整个路径上的iver_max的最大值。

**dcc_filesys_crtver：**客户端内存inode中缓存的系统创建版本号filesys_crtver。

**dcc_filesys_delver：**客户端内存inode中缓存的系统删除版本号filesys_crtver。

### 2022-7-12()

**REP(replication)：**远程复制模块。

**通路：**两个集群间的连接关系的逻辑概念。

**链路：**两个集群间的复制域中每对节点建立的网络连接。

**Pair：**两个集群的主、从LUN构成的复制关系，数据由主LUN向从LUN备份。

**异步复制：**可根据策略设定的时间，定时备份数据。

**RepEngine：**复制引擎模块，主要负责配置的对接，以及管理复制任务的运行。

**RepService：**复制数据模块，主要负责异步任务数据的读取（主端）和写入（从端）。

**RepTx：**复制链路管理模块，复制数据的传输，包含ReptxMgr（管理者）和ReoTxWorker（维护实际链路）。

**OSNAP_MGR(类快照控制模块)：**用于快照创删查、存取的模块。

**SNAP_TABLE(桶上最新类快照表)：**包含每个桶上最大的类快照版本、类快照差异文件描述等内存结构。

**OSCF(类快照差异文件)：**存储类快照差异记录的文件。

**OSCF_DIR(类快照差异文件描述索引)：**存储类快照差异文件索引的kv表。

**OSF(类快照文件)：**存储类快照、快照管理任务、快照版本的文件。


